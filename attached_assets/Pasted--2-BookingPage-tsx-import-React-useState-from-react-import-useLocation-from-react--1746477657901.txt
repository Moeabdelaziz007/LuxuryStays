// âœ… 2. BookingPage.tsx
import React, { useState } from "react";
import { useLocation } from "react-router-dom";
import { addDoc, collection, serverTimestamp } from "firebase/firestore";
import { db } from "@/lib/firebase";
import { useAuth } from "@/contexts/auth-context";

export default function BookingPage() {
  const { state } = useLocation();
  const propertyId = state?.propertyId || "";
  const { user } = useAuth();

  const [date, setDate] = useState("");
  const [guests, setGuests] = useState(1);
  const [notes, setNotes] = useState("");
  const [success, setSuccess] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!user) return;

    await addDoc(collection(db, "bookings"), {
      propertyId,
      userId: user.uid,
      date,
      guests,
      notes,
      status: "pending",
      createdAt: serverTimestamp(),
    });

    setSuccess(true);
  };

  return (
    <div className="bg-black text-white min-h-screen py-12 px-6">
      <div className="max-w-lg mx-auto bg-gray-900 p-8 rounded-2xl shadow-lg">
        <h2 className="text-3xl font-bold text-green-400 mb-6">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</h2>
        {success ? (
          <div className="text-center text-green-400 text-xl font-bold">âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­!</div>
        ) : (
          <form onSubmit={handleSubmit}>
            <p className="text-sm text-gray-400 mb-4">ğŸ” Ø®Ø§Øµ Ø¨Ø§Ù„Ø¹Ù‚Ø§Ø± Ø±Ù‚Ù…: {propertyId}</p>
            <label className="block mb-4">
              <span>ğŸ—“ï¸ Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
              <input type="date" value={date} onChange={(e) => setDate(e.target.value)} className="mt-2 w-full p-2 rounded bg-gray-800 text-white" required />
            </label>
            <label className="block mb-4">
              <span>ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ÙŠÙˆÙ:</span>
              <input type="number" min="1" value={guests} onChange={(e) => setGuests(Number(e.target.value))} className="mt-2 w-full p-2 rounded bg-gray-800 text-white" required />
            </label>
            <label className="block mb-4">
              <span>ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</span>
              <textarea value={notes} onChange={(e) => setNotes(e.target.value)} className="mt-2 w-full p-2 rounded bg-gray-800 text-white"></textarea>
            </label>
            <button type="submit" className="bg-green-400 text-black font-bold py-3 px-6 rounded-full text-lg hover:scale-105 transition-all">
              ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² âœ…
            </button>
          </form>
        )}
      </div>
    </div>
  );
}

// âœ… Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙØ­Ø§Øª ÙƒÙ…Ø§ Ù‡ÙŠØŒ Ø³ÙŠØªÙ… Ø±Ø¨Ø·Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…Ø¹ Firestore Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ± ÙˆØ§Ù„ÙˆØ¸ÙŠÙØ©
